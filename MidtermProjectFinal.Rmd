---
title: "MA678 Midterm Project"
author: "Yujia Wang"
date: "December 2, 2021"
output:
  pdf_document: 
          latex_engine: xelatex
  html_document: default
---

```{r setup, include=FALSE}
# set up
knitr::opts_chunk$set(echo=TRUE,
                      out.width="0.9\\linewidth",
                      dev="png",
                      fig.align='center',
                      message = FALSE,
                      warning = FALSE)
# library
pacman::p_load(ggplot2,
               knitr,
               arm,
               dplyr,
               stringr,
               rstan,
               rstanarm,
               readr,
               tidyverse,
               hrbrthemes,
               corrplot)
```

## Abstract

xxx 

## Introduction

xxx
https://www.kaggle.com/debajyotipodder/co2-emission-by-vehicles?select=CO2+Emissions_Canada.csv
https://open.canada.ca/data/en/dataset/98f1a129-f628-4ce4-b24d-6f16bf24dd64/resource/026e45b4-eb63-451f-b34f-d9308ea3a3d9?inner_span=True

## Method

### Data Cleaning and Combining

```{r, echo=FALSE}
# import two dataset
co2 <- read.csv("CO2EmissionsCanada.csv", header = T)
battery <- read.csv("MY2012-2021BatteryElectricVehicles.csv", header = T)
# clean "battery" dataset
battery <- battery[-c(1),c(2,3,4,6,7,11,12,13,15)]
battery <- battery %>%
  add_column(Engine.Size.L="NA")
battery <- battery %>%
  add_column(Cylinders="NA")
battery <- battery[,c(1,2,3,10,11,4,5,6,7,8,9)]
colnames(battery) <- c("Make","Model","VehicleClass","EngineSize","Cylinders","Transmission","FuelType","FC_City","FC_Hwy","FC_Comb","CO2Emissions")
battery <- battery[order(battery$Make),]
battery <- distinct(battery,Make,Model,VehicleClass,.keep_all=TRUE)
battery <- transform(battery,EngineSize=as.numeric(EngineSize),
                             Cylinders=as.integer(Cylinders),
                             FC_City=as.numeric(FC_City),
                             FC_Hwy=as.numeric(FC_Hwy),
                             FC_Comb=as.numeric(FC_Comb),
                             CO2Emissions=as.integer(CO2Emissions))
battery <- mutate(battery,Make=toupper(Make),Model=toupper(Model),VehicleClass=toupper(VehicleClass))

# clean "co2" dataset
co2 <- co2[,-c(11)]
colnames(co2) <- c("Make","Model","VehicleClass","EngineSize","Cylinders","Transmission","FuelType","FC_City","FC_Hwy","FC_Comb","CO2Emissions")
# combine two dataset
identical(names(co2), names(battery))
co2_final <- rbind(co2,battery)
co2_final <- co2_final[order(co2_final$Make),]
```

xxx

|column names                     |explanation|
|:--:                             |:-----|
|Make                             |Company of the vehicle|
|Model                            |Car Model|
|VehicleClass                     |Class of vehicle depending on their utility, capacity and weight|
|EngineSize                       |Size of engine used in Litre|
|Cylinders                        |Number of cylinders|
|Transmission                     |Transmission type with number of gears|
|FuelType                         |Type of Fuel used|
|FC_City                          |Fuel consumption in city roads (L/100 km)|
|FC_Hwy                           |Fuel consumption in highways (L/100 km)|
|FC_Comb                          |The combined fuel consumption (55% city, 45% highway) is shown in L/100 km|
|CO2Emissions                     |The tailpipe emissions of carbon dioxide (in grams per kilometre) for combined city and highway driving|

xxx

### Exploratory Data Analysis

xxx 

```{r, echo=FALSE}
# calculate "Make" amount
Make_data <- co2_final %>% 
  group_by(Make) %>% summarise(Count = n())
```

```{r, echo=FALSE, fig.height=7, fig.width=14, fig.cap="xxx"}
# variable "Make" barplot
ggplot(data=Make_data, aes(x=Make, y=Count)) +
  geom_bar(stat='identity', fill=rainbow(n=length(Make_data$Count))) +
  theme(axis.text.x=element_text(angle=90, vjust=0.7), plot.title=element_text(size=15)) +
  labs(x="Brand", y="Amount of vehicle", title="The amount of vehicle in different brands")
```

```{r, echo=FALSE, fig.height=7, fig.width=14, fig.cap="xxx"}
# "co2" boxplot
ggplot(data=co2_final, aes(x=Make, y=,CO2Emissions, fill=Make)) + 
    geom_boxplot() +
    theme(axis.text.x=element_text(angle=90, vjust=0.7), legend.position='none') +
    labs(x="Brand", y="CO2 emission", title="The CO2 emission of vehicle in different brands")
```

xxx

```{r, echo=FALSE, fig.height=7, fig.width=14, fig.cap="xxx"}
# distribution of CO2 emissions histogram
ggplot(data=co2_final, aes(x=CO2Emissions)) +
    geom_histogram(aes(y=..density..),binwidth=5, fill="#666666", color="#e9ecef") +
    geom_density(lwd=1.5,linetype=1,colour="#FF0033") +
    theme(plot.title=element_text(size=15)) +
    labs(x="CO2 emissions", y="Count", title="Distribution of CO2 emissions")
```

xxx

```{r, echo=FALSE}
# prepare for corrplot
Corrplot_data <- co2_final[,-c(1,2,3,6,7)]
Corrplot_data <- transform(Corrplot_data,
                             FC_City=as.numeric(FC_City),
                             FC_Hwy=as.numeric(FC_Hwy),
                             FC_Comb=as.numeric(FC_Comb),
                             CO2Emissions=as.numeric(CO2Emissions))
Corrplot_data_final <- cor(Corrplot_data, use =  "complete.obs")
round(Corrplot_data_final,2)
```

```{r, echo=FALSE, fig.height=7, fig.width=14, fig.cap="xxx"}
corrplot(Corrplot_data_final, type="upper", order="hclust", tl.col="black", tl.srt=45)
```

```{r}
# prepare for the pie plot
Percent_data_1 <- co2_final %>% 
  group_by(VehicleClass) %>% 
  count() %>% 
  ungroup() %>% 
  mutate(percent=`n`/sum(`n`)) 
Percent_data_1$label <- scales::percent(Percent_data_1$percent)

Percent_data_2 <- co2_final %>% 
  group_by(EngineSize) %>% 
  count() %>% 
  ungroup() %>% 
  mutate(percent=`n`/sum(`n`)) 
Percent_data_2$label <- scales::percent(Percent_data_2$percent)

Percent_data_3 <- co2_final %>% 
  group_by(Cylinders) %>% 
  count() %>% 
  ungroup() %>% 
  mutate(percent=`n`/sum(`n`)) 
Percent_data_3$label <- scales::percent(Percent_data_3$percent)

Percent_data_4 <- co2_final %>% 
  group_by(Transmission) %>% 
  count() %>% 
  ungroup() %>% 
  mutate(percent=`n`/sum(`n`)) 
Percent_data_4$label <- scales::percent(Percent_data_4$percent)

Percent_data_5 <- co2_final %>% 
  group_by(FuelType) %>% 
  count() %>% 
  ungroup() %>% 
  mutate(percent=`n`/sum(`n`)) 
Percent_data_5$label <- scales::percent(Percent_data_5$percent)
```

```{r, echo=FALSE, fig.height=7, fig.width=14, fig.cap="xxx"}
# pie plot: VehicleClass, EngineSize, Cylinders, Transmission, FuelType 
ggplot(data=Percent_data_1)+
  geom_bar(aes(x="", y=percent, fill=VehicleClass), stat="identity", width = 1)+
  coord_polar("y", start=0, direction = -1)+
  theme_void()+
  geom_text(aes(x=1, y = cumsum(percent)-percent/2), label=Percent_data_1$label)

ggplot(data=Percent_data_2)+
  geom_bar(aes(x="", y=percent, fill=EngineSize), stat="identity", width = 1)+
  coord_polar("y", start=0, direction = -1)+
  theme_void()+
  geom_text(aes(x=1, y = cumsum(percent)-percent/2), label=Percent_data_2$label)

ggplot(data=Percent_data_3)+
  geom_bar(aes(x="", y=percent, fill=Cylinders), stat="identity", width = 1)+
  coord_polar("y", start=0, direction = -1)+
  theme_void()+
  geom_text(aes(x=1, y = cumsum(percent)-percent/2), label=Percent_data_3$label)

ggplot(data=Percent_data_4)+
  geom_bar(aes(x="", y=percent, fill=Transmission), stat="identity", width = 1)+
  coord_polar("y", start=0, direction = -1)+
  theme_void()+
  geom_text(aes(x=1, y = cumsum(percent)-percent/2), label=Percent_data_4$label)

ggplot(data=Percent_data_5)+
  geom_bar(aes(x="", y=percent, fill=FuelType), stat="identity", width = 1)+
  coord_polar("y", start=0, direction = -1)+
  theme_void()+
  geom_text(aes(x=1, y = cumsum(percent)-percent/2), label=Percent_data_5$label)
```



### Model Fitting

```{r, echo=FALSE}

```

xxx

|                |Estimate   |Std. Error  |df        |t value |Pr(>&#124;t&#124;) |
|:---:           |:---:      |:---:       |:---:     |:---:   |:---:              |
|(Intercept)     |-12.93     |0.67        |16.75     |-19.43  |6.34e-13 ***       |
|log_duration    |0.79       |0.04        |24.53     |17.57   |2.10e-15 ***       |
|log_views       |0.33       |0.04        |12.21     |8.09    |2.99e-06 ***       |
|log_numlang     |2.33       |0.13        |10.98     |18.56   |1.21e-09 ***       |

## Result

## Model Coefficients

xxx

$$log(comments)= -12.70 + 0.77\cdot log(duration) + 0.32\cdot log(views) + 2.15\cdot log(numlang)$$

xxx

|                        |(Intercept) |log_duration |log_views  |log_numlang |
|:---:                   |:---:       |:---:        |:---:      |:---:       |
|Entertainment           |-12.70      |0.77         |0.32       |2.15        |
|News & Politics         |-14.37      |0.90         |0.38       |2.21        |
|People & Blogs          |-12.28      |0.73         |0.37       |2.47        |
|Science & Technology    |-13.37      |0.82         |0.21       |2.49        |

### Model Validation

```{r, echo=FALSE}

```
   
xxx

## Discussion

xxx

## Citation

xxx    

\newpage
## Appendix
```{r, echo=FALSE}

```












