---
title: "MA678 Midterm Project"
author: "Yujia Wang"
date: "December 12, 2021"
output:
  pdf_document: 
          latex_engine: xelatex
  html_document: default
---

```{r setup, include=FALSE}
# set up the environment
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE, highlight=FALSE)
knitr::opts_chunk$set(fig.width=6, fig.height=5,fig.align = "center") 
```

```{r}
# source my code
source("MidtermProject_Draft.R")
```


## Abstract

xxx 

## Introduction

xxx
https://www.kaggle.com/debajyotipodder/co2-emission-by-vehicles?select=CO2+Emissions_Canada.csv
https://open.canada.ca/data/en/dataset/98f1a129-f628-4ce4-b24d-6f16bf24dd64/resource/026e45b4-eb63-451f-b34f-d9308ea3a3d9?inner_span=True

## Method

### Data Cleaning and Combining

xxx

|column names                     |explanation|
|:--:                             |:-----|
|Make                             |Company of the vehicle|
|Model                            |Car Model|
|VehicleClass                     |Class of vehicle depending on their utility, capacity and weight|
|EngineSize                       |Size of engine used in Litre|
|Cylinders                        |Number of cylinders|
|Transmission                     |Transmission type with number of gears|
|FuelType                         |Type of Fuel used|
|FC_City                          |Fuel consumption in city roads (L/100 km)|
|FC_Hwy                           |Fuel consumption in highways (L/100 km)|
|FC_Comb                          |The combined fuel consumption (55% city, 45% highway) in L/100 km|
|CO2Emissions                     |The tailpipe emissions of carbon dioxide (in grams per kilometre) for combined city and highway driving|

xxx

### Exploratory Data Analysis

xxx 

```{r, fig.height=5, fig.width=10, fig.cap="xxx"}
# variable "Make" barplot
make_barplot
```

xxx 

```{r, fig.height=5, fig.width=10, fig.cap="xxx"}
# "co2" boxplot
co2_boxplot
```

xxx

```{r, fig.height=5, fig.width=7, fig.cap="xxx"}
# ggpairs
ggpairs
```

xxx

```{r, fig.height=7, fig.width=14, fig.cap="xxx"}
# stack plot: VehicleClass, EngineSize, Cylinders, Transmission, FuelType 

```

### Model Fitting

```{r}
# fit model
model1 <- lmer(CO2Emissions ~ VehicleClass_Value + EngineSize + FC_Comb + (1+EngineSize|Transmission) + (1+FC_Comb|FuelType), data=co2_final)

model2 <- lmer(log(CO2Emissions) ~ VehicleClass_Value + EngineSize + FC_Comb + (1+EngineSize|Transmission) + (1+FC_Comb|FuelType), data=co2_final2)

# estimate result
summary(model)

# coefficient
coef(model)

# fix effect
fixef(model)

# random effect
ranef(model)



random_fueltype <- as.data.frame(ranef(model2)$FuelType)
random_transmission <- as.data.frame(ranef(model2)$Transmission)

```

```{r}
anova(model)



```






```{r}
library(devtools)
devtools::install_github("strengejacke/sjPlot")
library(lme4)
install.packages("sjPlot")
install.packages("sjmisc")
library(sjPlot)
library(sjmisc)
devtools::install_github("strengejacke/strengejacke")

#http://www.strengejacke.de/sjPlot/news/index.html
plot_model(model, y.offset = .4)
rdfp1 <- plot_model(model,show.values = TRUE, value.offset = .3,vline.color = "black") + theme_bw() +
  theme(panel.border = element_blank(),
        axis.line = element_line(colour = "black"),
        plot.title = element_text(hjust = 0.5))

sjp.lmer(model1, type = "rs.ri", vars = "c12hour", sample.n = 15)


#################

visual_ef <- REsim(model2)
pp <- plotREsim(visual_ef)
pp

dotplot(ranef(model2,condVar=TRUE))


#grid.arrange(,nrow=2)



##################
lmer_model_1 <- lmer(log(popularity) ~ rating + score + rank + rating:score + (1 | rating) + (1 | source:type), data = movie)

rdfp1 <- plot_model(model,show.values = TRUE, value.offset = .3,vline.color = "black") + theme_bw() +
  theme(panel.border = element_blank(),
        axis.line = element_line(colour = "black"),
        plot.title = element_text(hjust = 0.5))

#################
sjp.glm(model)
```


```{r, echo=FALSE}

library("bruceR")
HLM_summary(model1)
HLM_summary(model2)

#install.packages("MuMIn")
library("MuMIn")




anova( , , )
install.packages("texreg")
library("texreg")
texreg::screenreg(list( , , ))
```


xxx



## Result

## Model Coefficients

xxx

$$log(comments)= -12.70 + 0.77\cdot log(duration) + 0.32\cdot log(views) + 2.15\cdot log(numlang)$$

xxx

### Model Validation

```{r}

```

   
xxx

## Discussion

xxx





## Reference

https://stat.ethz.ch/~meier/teaching/anova/random-and-mixed-effects-models.html

https://psych252.github.io/psych252book/linear-mixed-effects-models-2.html    

\newpage
## Appendix







